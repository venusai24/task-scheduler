syntax = "proto3";
package sched;
option go_package = "github.com/venusai24/task-scheduler/proto";

enum GovernanceMode {
  ADVISORY_ONLY = 0;
  AUTONOMOUS = 1;
  HUMAN_GATE = 2;
}

enum TaskState {
  CREATED = 0;
  PENDING = 1;
  RUNNING = 2;
  COMPLETED = 3;
  FAILED = 4;
  ANALYZING = 5;
  NEEDS_APPROVAL = 6; // <--- Add this
}

message Task {
  string id = 1;
  string intent_yaml = 2;
  TaskState state = 3;
  GovernanceMode mode = 4;
  int32 retry_count = 5;
  repeated string logs = 6;
  string ai_insight = 7;
  bool is_simulation = 8; // <--- Add this
}

service SchedService {
  rpc SubmitIntent (SubmitRequest) returns (SubmitResponse);
  rpc GetTask (TaskRequest) returns (TaskResponse);
  rpc ApproveTask (ApproveRequest) returns (ApproveResponse); // <--- Add this
  rpc RollbackTask (RollbackRequest) returns (RollbackResponse); // <--- Add this
}

message ApproveRequest { string task_id = 1; } // <--- Add this
message ApproveResponse {                      // <--- Add this
    bool success = 1;
    string message = 2;
}

message RollbackRequest { string task_id = 1; } // <--- Add this
message RollbackResponse {                      // <--- Add this
    bool success = 1;
    string message = 2;
}

message SubmitRequest { 
  string yaml_content = 1;
  bool dry_run = 2; // <--- Add this
}
message SubmitResponse { string task_id = 1; }
message TaskRequest { string task_id = 1; }
message TaskResponse { Task task = 1; }